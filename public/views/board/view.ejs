<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= post ? post.title : "글 보기" %></title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/header.css">
</head>
<body>
  <%- include("../partials/header") %>

  <div class="container">
    <% if (!post) { %>
      <div class="board-empty">글을 찾을 수 없습니다.</div>
      <a href="/board" class="board-btn">목록</a>
    <% } else { %>
      <h2 style="margin-top:0;"><%= post.title %></h2>
      <div class="board-post-meta">
        <span><%= post.author_nickname || post.author_username || "알 수 없음" %></span>
        <span>·</span>
        <span><%= (post.created_at || "").slice(0, 19).replace("T"," ") %></span>
      </div>

      <div class="board-post-content"><%= post.content %></div>

      <!-- 이미지 표시: R2 접근 방식에 따라 src 바꿔야 함 -->
      <% if (images && images.length > 0) { %>
        <div class="board-images">
          <% images.forEach(img => { %>
            <div class="board-image">
              <div class="board-image-name"><%= img.file_name || "image" %></div>
              <!-- TODO: R2 이미지 제공 URL/프록시 라우트로 교체 -->
              <div style="color:#666; font-size:13px;">file_key: <%= img.file_key %></div>
            </div>
          <% }) %>
        </div>
      <% } %>

      <hr style="border:0; border-top:1px solid rgba(0,0,0,0.15); margin:18px 0;">

      <h3 style="margin:0 0 10px;">댓글</h3>

      <form method="POST" action="/board/<%= post.id %>/comment" class="board-comment-form">
        <textarea name="content" rows="3" placeholder="댓글을 입력하세요" required></textarea>
        <button type="submit" class="board-btn">등록</button>
      </form>

      <div class="board-comments">
        <% if (!comments || comments.length === 0) { %>
          <div class="board-empty">댓글이 없습니다.</div>
        <% } else { %>
          <% comments.forEach(c => { %>
            <div class="board-comment">
              <div class="board-comment-head">
                <strong><%= c.author_nickname || c.author_username || "알 수 없음" %></strong>
                <span><%= (c.created_at || "").slice(0, 19).replace("T"," ") %></span>
              </div>
              <div class="board-comment-body"><%= c.content %></div>
            </div>
          <% }) %>
        <% } %>
      </div>

      <div style="margin-top:14px;">
        <a href="/board" class="board-btn board-btn--ghost">목록</a>
      </div>
    <% } %>
  </div>
</body>
</html>
