{
  "version": 3,
  "sources": ["../../../node_modules/src/src/Router.ts", "../../../node_modules/src/src/StatusError.ts", "../../../node_modules/src/src/createResponse.ts", "../../../node_modules/src/src/json.ts", "../../../node_modules/src/src/error.ts", "../../../node_modules/src/src/status.ts", "../../../node_modules/src/src/text.ts", "../../../node_modules/src/src/html.ts", "../../../node_modules/src/src/jpeg.ts", "../../../node_modules/src/src/png.ts", "../../../node_modules/src/src/webp.ts", "../../../node_modules/src/src/withContent.ts", "../../../node_modules/src/src/withCookies.ts", "../../../node_modules/src/src/withParams.ts", "../../../node_modules/src/src/createCors.ts", "../../../src/index.js"],
  "sourceRoot": "C:\\Users\\user\\OneDrive\\\uBC14\uD0D5 \uD654\uBA74\\jellypolice\\d1-worker\\.wrangler\\tmp\\deploy-CieaxL",
  "sourcesContent": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "import { Router } from 'itty-router';\r\n\r\nconst router = Router();\r\n\r\nfunction json(data, init = {}) {\r\n  return new Response(JSON.stringify(data), {\r\n    headers: { 'content-type': 'application/json; charset=utf-8' },\r\n    ...init,\r\n  });\r\n}\r\n\r\nfunction ok() {\r\n  return new Response(null, { status: 204 });\r\n}\r\n\r\nfunction unauthorized() {\r\n  return json({ error: 'unauthorized' }, { status: 401 });\r\n}\r\n\r\nasync function readBody(request) {\r\n  const text = await request.text();\r\n  if (!text) return {};\r\n  try {\r\n    return JSON.parse(text);\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\nfunction isAdmin(request, env) {\r\n  const token = env.API_TOKEN || '';\r\n  if (!token) return true; // \uD1A0\uD070\uC744 \uC548 \uC4F0\uBA74(\uBE48\uAC12\uC774\uBA74) \uAC80\uC99D \uC2A4\uD0B5\r\n  const auth = request.headers.get('authorization') || '';\r\n  return auth === `Bearer ${token}`;\r\n}\r\n\r\n// ---- page helpers ----\r\nconst DEFAULT_PAGES = {\r\n  agency: {\r\n    title: '\uC824\uB9AC\uACBD\uCC30\uCCAD \uAE30\uAD00 \uC18C\uAC1C',\r\n    content: '\uC824\uB9AC \uACBD\uCC30\uCCAD\uC740 \uC2DC\uBBFC\uC758 \uC548\uC804\uACFC \uC9C8\uC11C\uB97C \uC704\uD574 \uC874\uC7AC\uD569\uB2C8\uB2E4.',\r\n  },\r\n  rank: {\r\n    title: '\uC824\uB9AC\uACBD\uCC30\uCCAD \uC9C1\uAE09\uD45C',\r\n    high: { '\uCE58\uC548\uCD1D\uAC10': '', '\uCE58\uC548\uC815\uAC10': '', '\uCE58\uC548\uAC10': '' },\r\n    mid: { '\uACBD\uBB34\uAD00': '', '\uCD1D\uACBD': '', '\uACBD\uC815': '', '\uACBD\uAC10': '' },\r\n    normal: {\r\n      '\uACBD\uC704': ['', '', '', '', ''],\r\n      '\uACBD\uC0AC': ['', '', '', '', ''],\r\n      '\uACBD\uC7A5': ['', '', '', '', ''],\r\n      '\uC21C\uACBD': ['', '', '', '', ''],\r\n    },\r\n    probation: ['', '', '', '', ''],\r\n  },\r\n  department: {\r\n    title: '\uBD80\uC11C \uC18C\uAC1C',\r\n    teams: [],\r\n  },\r\n};\r\n\r\nasync function getOrSeedPage(env, key) {\r\n  const row = await env.DB\r\n    .prepare('SELECT page_json FROM pages WHERE page_key = ?')\r\n    .bind(key)\r\n    .first();\r\n\r\n  if (row && row.page_json) {\r\n    try {\r\n      return JSON.parse(row.page_json);\r\n    } catch {\r\n      return DEFAULT_PAGES[key] || {};\r\n    }\r\n  }\r\n\r\n  const data = DEFAULT_PAGES[key] || {};\r\n  await env.DB\r\n    .prepare('INSERT OR REPLACE INTO pages(page_key, page_json, updated) VALUES(?, ?, ?)')\r\n    .bind(key, JSON.stringify(data), new Date().toISOString())\r\n    .run();\r\n\r\n  return data;\r\n}\r\n\r\nasync function setPage(env, key, data) {\r\n  await env.DB\r\n    .prepare('INSERT OR REPLACE INTO pages(page_key, page_json, updated) VALUES(?, ?, ?)')\r\n    .bind(key, JSON.stringify(data || {}), new Date().toISOString())\r\n    .run();\r\n}\r\n\r\n// ---- Root ----\r\nrouter.get('/', () =>\r\n  new Response('Jelly Police D1 API is running', {\r\n    headers: { 'Content-Type': 'text/plain; charset=utf-8' },\r\n  })\r\n);\r\n\r\n// ---- Health ----\r\nrouter.get('/api/health', () => json({ ok: true }));\r\n\r\n// ---- Pages ----\r\nrouter.get('/api/agency', async (req, env) => json(await getOrSeedPage(env, 'agency')));\r\nrouter.get('/api/rank', async (req, env) => json(await getOrSeedPage(env, 'rank')));\r\nrouter.get('/api/department', async (req, env) => json(await getOrSeedPage(env, 'department')));\r\n\r\nrouter.put('/api/agency', async (req, env) => {\r\n  if (!isAdmin(req, env)) return unauthorized();\r\n  const body = await readBody(req);\r\n  await setPage(env, 'agency', body);\r\n  return ok();\r\n});\r\n\r\nrouter.put('/api/rank', async (req, env) => {\r\n  if (!isAdmin(req, env)) return unauthorized();\r\n  const body = await readBody(req);\r\n  await setPage(env, 'rank', body);\r\n  return ok();\r\n});\r\n\r\nrouter.put('/api/department', async (req, env) => {\r\n  if (!isAdmin(req, env)) return unauthorized();\r\n  const body = await readBody(req);\r\n  await setPage(env, 'department', body);\r\n  return ok();\r\n});\r\n\r\n// ---- Complaints ----\r\nrouter.get('/api/complaints', async (req, env) => {\r\n  if (!isAdmin(req, env)) return unauthorized();\r\n  const { results } = await env.DB\r\n    .prepare('SELECT id, name, identity, content, created, fileName, fileKey FROM complaints ORDER BY id DESC')\r\n    .all();\r\n  return json(results || []);\r\n});\r\n\r\nrouter.post('/api/complaints', async (req, env) => {\r\n  const body = await readBody(req);\r\n  const created = body.created || new Date().toISOString();\r\n\r\n  const r = await env.DB\r\n    .prepare('INSERT INTO complaints(name, identity, content, created, fileName, fileKey) VALUES(?, ?, ?, ?, ?, ?)')\r\n    .bind(\r\n      body.name || '',\r\n      body.identity || '',\r\n      body.content || '',\r\n      created,\r\n      body.fileName || '',\r\n      body.fileKey || ''\r\n    )\r\n    .run();\r\n\r\n  return json({ ok: true, id: r.meta?.last_row_id || null });\r\n});\r\n\r\n// ---- Suggestions ----\r\nrouter.get('/api/suggestions', async (req, env) => {\r\n  if (!isAdmin(req, env)) return unauthorized();\r\n  const { results } = await env.DB\r\n    .prepare('SELECT id, name, identity, content, created FROM suggestions ORDER BY id DESC')\r\n    .all();\r\n  return json(results || []);\r\n});\r\n\r\nrouter.post('/api/suggestions', async (req, env) => {\r\n  const body = await readBody(req);\r\n  const created = body.created || new Date().toISOString();\r\n\r\n  const r = await env.DB\r\n    .prepare('INSERT INTO suggestions(name, identity, content, created) VALUES(?, ?, ?, ?)')\r\n    .bind(body.name || '', body.identity || '', body.content || '', created)\r\n    .run();\r\n\r\n  return json({ ok: true, id: r.meta?.last_row_id || null });\r\n});\r\n\r\nrouter.all('*', () => json({ error: 'not_found' }, { status: 404 }));\r\n\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    return router.handle(request, env, ctx);\r\n  },\r\n};\r\n"],
  "mappings": "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",
  "names": ["Router", "base", "routes", "other", "__proto__", "Proxy", "get", "target", "prop", "receiver", "path", "fetch", "route", "handlers", "push", "toUpperCase", "RegExp", "replace", "async", "request", "args", "response", "match", "url", "URL", "query", "k", "v", "searchParams", "concat", "method", "regex", "pathname", "params", "groups", "handler", "proxy", "createResponse", "format", "transform", "body", "headers", "rest", "constructor", "name", "Response", "entries", "Object", "fromEntries", "json", "JSON", "stringify", "text", "createResponse", "String", "html", "jpeg", "png", "webp"]
}
